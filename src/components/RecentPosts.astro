---
import { config } from '../config';
import { slugifyPath } from '../utils/slugify';

const base = config.baseUrl;

const mdPostsGlob = import.meta.glob('../content/blog/*.md', { eager: true });
const mdxPostsGlob = import.meta.glob('../content/blog/*.mdx', { eager: true });
const allPosts = [...Object.values(mdPostsGlob), ...Object.values(mdxPostsGlob)] as any[];
const recentPosts = allPosts
  .filter((post: any) => !post.frontmatter.draft)
  .sort(
    (a: any, b: any) =>
      new Date(b.frontmatter.datePublished).getTime() -
      new Date(a.frontmatter.datePublished).getTime()
  )
  .slice(0, 5);
---

{
  recentPosts.length > 0 && (
    <section class='recent-posts'>
      <h3 class='section-title'>Recent Posts</h3>
      <ul class='post-list'>
        {recentPosts.map((post) => (
          <li class='post-item'>
            <a href={`${base}blog/${slugifyPath(post.file)}`} data-astro-prefetch class='post-link'>
              {post.frontmatter.title}
            </a>
            <time class='post-date' datetime={post.frontmatter.datePublished}>
              {new Date(post.frontmatter.datePublished).toLocaleDateString('en-GB', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
              })}
            </time>
          </li>
        ))}
      </ul>
    </section>
  )
}

<style>
  .recent-posts {
    margin-bottom: calc(var(--grid-unit) * 4);
  }

  .section-title {
    font-family: var(--font-heading-secondary);
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--color-accent);
    margin-bottom: calc(var(--grid-unit) * 1.5);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-bottom: 2px solid var(--color-accent);
    padding-bottom: calc(var(--grid-unit) / 2);
  }

  .post-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: calc(var(--grid-unit) * 1.5);
  }

  .post-item {
    display: flex;
    flex-direction: column;
    gap: calc(var(--grid-unit) / 2);
  }

  .post-link {
    font-weight: 500;
    line-height: 1.3;
    color: var(--color-text-primary);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .post-link:hover,
  .post-link:focus {
    color: var(--color-accent);
  }

  .post-date {
    font-size: 0.85rem;
    color: var(--color-text-muted);
    font-family: var(--font-mono);
  }
</style>
