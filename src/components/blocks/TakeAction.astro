---
import { isArray, isObject, keys } from 'radash';
import ActionCard from './ActionCard.astro';
import ActionGroup from './ActionGroup.astro';
import DonateOrgCard from './DonateOrgCard.astro';

export interface Props {
  takeAction?: {
    donate?: Array<{
      organisation?: string;
      description?: string;
      url?: string;
    }>;
    advocacy?: Array<string>;
  };
  id?: string;
}

const { takeAction, id } = Astro.props as Props;

const safeTakeAction = isObject(takeAction) ? takeAction : {};
if (keys(safeTakeAction).length === 0) {
  return null;
}

const donateData = isArray(safeTakeAction.donate) ? safeTakeAction.donate : [];
const advocacyData = isArray(safeTakeAction.advocacy)
  ? safeTakeAction.advocacy
  : [];
---

<section
  class='action-section'
  {...id ? { id } : {}}
  aria-labelledby='how-you-can-help'
>
  <h2 id='how-you-can-help'>How You Can Help</h2>

  {
    donateData.length > 0 && (
      <ActionGroup icon='ri-heart-line' title='Donate'>
        <div class='donate-organisations'>
          {donateData.map((org) => (
            <DonateOrgCard
              organisation={org.organisation}
              description={org.description}
              url={org.url}
            />
          ))}
        </div>
      </ActionGroup>
    )
  }

  {
    advocacyData.length > 0 && (
      <ActionGroup icon='ri-megaphone-line' title='Advocacy'>
        <div class='advocacy-list'>
          {advocacyData.map((action) => (
            <ActionCard content={action ?? ''} />
          ))}
        </div>
      </ActionGroup>
    )
  }
</section>

<style>
  .action-section {
    background: var(--bg-card);
    border: var(--card-border);
    border-radius: var(--card-radius);
    padding: var(--section-gap);
    margin-bottom: var(--section-gap);
  }

  .action-section h2 {
    margin-top: 0;
    border-bottom: var(--section-heading-border);
    padding-bottom: var(--section-heading-padding-bottom);
    font-size: 1.5rem;
    font-weight: var(--font-weight-bold);
    color: var(--text-primary);
    margin-bottom: var(--heading-gap);
  }

  .donate-link i {
    font-size: 1rem;
  }

  .donate-organisations {
    display: grid;
    gap: var(--gap-lg);
  }

  .org-item {
    background: var(--bg-surface);
    border: var(--card-border);
    border-radius: var(--card-radius);
    padding: var(--heading-gap);
  }

  .org-item h4 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    color: var(--text-primary);
    margin: 0 0 calc(var(--heading-gap) / 2);
  }

  .org-item p {
    color: var(--text-secondary);
    margin: 0 0 var(--heading-gap) 0;
    line-height: var(--line-height-base);
  }

  .donate-link {
    display: inline-flex;
    align-items: center;
    gap: var(--gap-sm);
    background: var(--accent-primary);
    color: var(--on-accent);
    text-decoration: none;
    padding: 0.75rem 1.25rem;
    border-radius: var(--button-radius);
    font-weight: var(--font-weight-semibold);
    font-size: 0.95rem;
    transition: var(--link-transition);
    min-height: 44px;
    box-sizing: border-box;
  }

  .donate-link:hover {
    background: var(--accent-secondary);
    transform: var(--hover-transform);
    box-shadow: var(--hover-shadow);
  }

  .donate-link:active {
    transform: scale(0.95);
    transition: transform 0.1s ease;
  }

  .awareness-list,
  .advocacy-list {
    padding: 0;
    margin: 0;
    display: grid;
    gap: var(--gap);
  }

  .action-card {
    background: var(--bg-surface);
    border: var(--card-border);
    border-radius: var(--button-radius);
    padding: var(--card-padding);
    color: var(--text-secondary);
    line-height: var(--line-height-base);
  }

  @media (width >= 768px) {
    .action-section {
      padding: calc(var(--section-gap) + var(--space-xs));
      margin-bottom: calc(var(--section-gap) + var(--space-xs));
    }

    .org-item {
      padding: calc(var(--heading-gap) * 1.1);
    }

    .donate-link {
      padding: 0.75rem 1.25rem;
      font-size: 0.95rem;
      min-height: 44px;
    }

    .action-card {
      padding: var(--card-padding);
    }
  }

  @media (hover: none) and (pointer: coarse) {
    .donate-link {
      min-height: 48px;
      padding: 1rem 1.5rem;
    }

    .donate-link:active {
      background: var(--accent-tertiary);
      transform: scale(0.95);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .donate-link {
      transition: none;
      transform: none;
    }
  }
</style>
