---
import { isArray, keys } from 'radash';
import ActionSection from './ActionSection.astro';
import type { ActionGroupData } from './ActionSection.astro';

export interface Properties {
  takeAction?: {
    donate?: Array<{
      organisation?: string;
      description?: string;
      url?: string;
    }>;
    advocacy?: Array<string>;
  };
  id?: string;
}

const { takeAction, id } = Astro.props as Properties;

if (keys(takeAction!).length === 0) {
  return;
}

const donateData = isArray(takeAction!.donate) ? takeAction!.donate : [];
const advocacyData = isArray(takeAction!.advocacy) ? takeAction!.advocacy : [];

const groups: ActionGroupData[] = [];

if (donateData.length > 0) {
  groups.push({
    icon: 'ri-heart-line',
    title: 'Donate',
    type: 'links',
    items: donateData.map((org) => ({
      title: org.organisation || 'Organisation',
      description: org.description,
      url: org.url || '#',
      buttonText: 'Donate',
    })),
  });
}

if (advocacyData.length > 0) {
  groups.push({
    icon: 'ri-megaphone-line',
    title: 'Advocacy',
    type: 'cards',
    items: advocacyData,
  });
}
---

{groups.length > 0 && <ActionSection sectionTitle='How You Can Help' groups={groups} id={id} />}
