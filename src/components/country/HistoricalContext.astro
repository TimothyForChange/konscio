---
import { isEmpty, isObject, isString, keys } from 'radash';
import { formatTermKey, formatText } from '../../utils';

export interface Properties {
  coreTerms?: Record<string, string>;
  countrySlug: string;
}

const { coreTerms, countrySlug } = Astro.props as Properties;

const safeCountrySlug = isString(countrySlug) ? countrySlug : '';
if (!safeCountrySlug) {
  return;
}

const safeCoreTerms = isObject(coreTerms) ? coreTerms : {};

const hasTerms = !isEmpty(keys(safeCoreTerms));
if (!hasTerms) {
  return;
}

const hasContent = Object.values(safeCoreTerms).some(
  (value) => isString(value) && value.trim() !== ''
);
if (!hasContent) {
  return;
}
---

<section class='terms-section' aria-labelledby='history-heading'>
  <h2 id='history-heading'>Historical Context</h2>

  {
    Object.entries(safeCoreTerms)
      .filter(
        ([key, value]) =>
          isString(key) &&
          isString(value) &&
          key.trim() !== '' &&
          value.trim() !== ''
      )
      .map(([key, value]) => (
        <div class='term-group'>
          <h3>{formatTermKey(key, safeCountrySlug)}</h3>
          <p set:html={formatText(value)} />
        </div>
      ))
  }
</section>

<style>
  .terms-section {
    margin-bottom: var(--section-gap);
  }

  .terms-section h2 {
    font-size: var(--section-heading-size);
    font-weight: var(--font-weight-bold);
    color: var(--text-primary);
    margin-bottom: var(--heading-gap);
    border-bottom: var(--section-heading-border);
    padding-bottom: var(--section-heading-padding-bottom);
  }

  .terms-section h3 {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--text-primary);
    margin-bottom: var(--gap);
    margin-top: var(--heading-gap);
  }

  .term-group {
    margin-bottom: calc(var(--heading-gap) * 1.25);
  }

  .term-group:last-child {
    margin-bottom: 0;
  }

  .term-group:first-child h3 {
    margin-top: 0;
  }

  @media (width >= 768px) {
    .terms-section h2 {
      font-size: var(--section-heading-size-lg);
    }
  }
</style>
