---
import emailButtonScriptUrl from '../scripts/email-button.ts?url';

interface EmailButtonProps {
  icon: string;
  title: string;
  description?: string;
  emailUser: string;
  emailDomain: string;
}

const {
  icon,
  title,
  description = 'Click to reveal and copy email address',
  emailUser,
  emailDomain,
} = Astro.props as EmailButtonProps;

const rev = (s: string) => [...s].reverse().join('');
const b64 = (s: string) => Buffer.from(s).toString('base64');
const userEnc = b64(rev(emailUser));
const domainEnc = b64(rev(emailDomain));
---

<div class='email-link-wrapper'>
  <button
    type='button'
    class='link fade-in email-link'
    data-user-e={userEnc}
    data-domain-e={domainEnc}
    aria-label={`Reveal and copy email for ${title}`}
    data-state='concealed'
    data-behavior='copy-email'
  >
    <span class='link-icon' aria-hidden='true'>
      <i class={`ri-${icon}`} aria-hidden='true'></i>
    </span>
    <div class='link-content'>
      <span class='link-title' role='heading' aria-level='2'>{title}</span>
      <p class='link-description' data-placeholder='email'>{description}</p>
      <noscript><span>timothy [at] mooship [dot] co [dot] za</span></noscript>
    </div>
  </button>
  <span class='visually-hidden email-feedback' aria-live='polite'></span>
  <script type='module' src={emailButtonScriptUrl} async></script>
</div>
