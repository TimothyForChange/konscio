---
import Layout from './Layout.astro';
import 'remixicon/fonts/remixicon.css';

const { countryData } = Astro.props;

function formatText(text: string): string {
  return text
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>');
}

const countryFlags: Record<string, { emoji: string; ariaLabel: string }> = {
  Palestine: { emoji: 'ðŸ‡µðŸ‡¸', ariaLabel: 'Palestinian flag' },
  Sudan: { emoji: 'ðŸ‡¸ðŸ‡©', ariaLabel: 'Sudanese flag' },
  Myanmar: { emoji: 'ðŸ‡²ðŸ‡²', ariaLabel: 'Myanmar flag' },
  Ukraine: { emoji: 'ðŸ‡ºðŸ‡¦', ariaLabel: 'Ukrainian flag' },
  'Democratic Republic of the Congo': {
    emoji: 'ðŸ‡¨ðŸ‡©',
    ariaLabel: 'Democratic Republic of Congo flag',
  },
};

const flagInfo = countryFlags[countryData.name];
---

<Layout title={`${countryData.name} Crisis - Timothy Brits`}>
  <div class='page-wrapper'>
    <main class='container' id='container'>
      <div class='country-page'>
        <header class='country-header'>
          <a href='/' class='back-button'>
            <i class='ri-arrow-left-line'></i>
            Back to Home
          </a>
          <h1 class='country-title'>
            {countryData.name}
            {
              flagInfo && (
                <span class='country-flag' aria-label={flagInfo.ariaLabel}>
                  {flagInfo.emoji}
                </span>
              )
            }
          </h1>
        </header>

        <section class='crisis-section'>
          <h2>Current Crisis Summary</h2>
          <p set:html={formatText(countryData.currentCrisisSummary)} />
        </section>

        <section class='colonial-section'>
          <h2>The Colonial Root</h2>
          <h3>{countryData.colonialRoot.colonialPower}</h3>
          <p set:html={formatText(countryData.colonialRoot.legacy)} />
        </section>

        <section class='terms-section'>
          <h2>Historical Context</h2>

          {
            Object.entries(countryData.coreTerms).map(([key, value]) => (
              <div class='term-group'>
                <h3>
                  {key === 'internationalDynamics'
                    ? 'International Dynamics'
                    : key === 'historicalLegacies'
                      ? 'Historical Legacies'
                      : key === 'contemporaryContext'
                        ? 'Contemporary Context'
                        : key === 'historicalPatterns'
                          ? 'Historical Patterns'
                          : key === 'centralisation'
                            ? 'Centralisation'
                            : key === 'historicalDivisions'
                              ? 'Historical Divisions'
                              : key === 'externalInfluences'
                                ? 'External Influences'
                                : key === 'structuralChallenges'
                                  ? 'Structural Challenges'
                                  : key === 'geopoliticalDimensions'
                                    ? 'Geopolitical Dimensions'
                                    : key === 'regionalInequalities'
                                      ? 'Regional Inequalities'
                                      : key.charAt(0).toUpperCase() +
                                        key.slice(1)}
                </h3>
                <p set:html={formatText(value as string)} />
              </div>
            ))
          }
        </section>

        {
          countryData.humanitarianImpact && (
            <section class='humanitarian-section'>
              <h2>Humanitarian Impact</h2>
              <div class='impact-stats'>
                <div class='stat-item'>
                  <strong>Displaced:</strong>{' '}
                  <span
                    set:html={formatText(
                      countryData.humanitarianImpact.displaced
                    )}
                  />
                </div>
                <div class='stat-item'>
                  <strong>Refugees:</strong>{' '}
                  <span
                    set:html={formatText(
                      countryData.humanitarianImpact.refugees
                    )}
                  />
                </div>
                <div class='stat-item'>
                  <strong>Casualties:</strong>{' '}
                  <span
                    set:html={formatText(
                      countryData.humanitarianImpact.casualties
                    )}
                  />
                </div>
                <div class='stat-item'>
                  <strong>Affected:</strong>{' '}
                  <span
                    set:html={formatText(
                      countryData.humanitarianImpact.affected
                    )}
                  />
                </div>
              </div>
            </section>
          )
        }

        {
          countryData.takeAction && (
            <section class='action-section'>
              <h2>How You Can Help</h2>

              <div class='action-group'>
                <h3>
                  <i class='ri-heart-line' /> Donate
                </h3>
                <div class='donate-organisations'>
                  {countryData.takeAction.donate.map((org: any) => (
                    <div class='org-item'>
                      <h4>{org.organisation}</h4>
                      <p>{org.description}</p>
                      <a
                        href={org.url}
                        target='_blank'
                        rel='noopener noreferrer'
                        class='donate-link'
                      >
                        <i class='ri-external-link-line' />
                        Donate
                      </a>
                    </div>
                  ))}
                </div>
              </div>

              <div class='action-group'>
                <h3>
                  <i class='ri-megaphone-line' /> Raise Awareness
                </h3>
                <div class='awareness-list'>
                  {countryData.takeAction.awareness.map((action: string) => (
                    <div class='action-card' set:html={formatText(action)} />
                  ))}
                </div>
              </div>

              <div class='action-group'>
                <h3>
                  <i class='ri-shield-line' /> Economic Action
                </h3>
                <div class='boycott-list'>
                  {countryData.takeAction.boycott.map((action: string) => (
                    <div class='action-card'>{action}</div>
                  ))}
                </div>
              </div>
            </section>
          )
        }

        <div class='country-bottom-back'>
          <a href='/' class='back-button'>
            <i class='ri-arrow-left-line'></i>
            Back to Home
          </a>
        </div>
      </div>
    </main>
  </div>
</Layout>
