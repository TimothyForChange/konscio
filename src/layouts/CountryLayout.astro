---
import TakeAction from '../components/blocks/TakeAction.astro';
import ColonialSection from '../components/country/ColonialSection.astro';
import CountryHeader from '../components/country/CountryHeader.astro';
import CrisisSection from '../components/country/CrisisSection.astro';
import HistoricalContext from '../components/country/HistoricalContext.astro';
import HumanitarianImpact from '../components/country/HumanitarianImpact.astro';
import Timeline from '../components/country/Timeline.astro';
import BackButton from '../components/shared/BackButton.astro';
import Layout from './Layout.astro';
import 'remixicon/fonts/remixicon.css';

export interface CountryData {
  name?: string;
  currentCrisisSummary?: string;
  humanitarianImpact?: Record<string, string>;
  timeline?: Array<Record<string, string>>;
  colonialRoot?: {
    colonialPower?: string;
    legacy?: string;
  };
  coreTerms?: Record<string, string>;
  takeAction?: Record<string, unknown>;
}

export interface Props {
  countryData?: CountryData;
  title?: string;
  countrySlug: string;
}

const { countryData, countrySlug } = Astro.props as Props;
const passedTitle = (Astro.props as Props).title;
const safeName = countryData?.name ?? 'Country';
const pageDescription = `Learn about the humanitarian crisis in ${safeName} - Timothy Brits raises awareness about ongoing conflicts and issues affecting communities worldwide.`;
const canonicalUrl = `https://timothyforchange.co.za/${safeName.toLowerCase()}`;
---

<Layout
  title={passedTitle ?? `${safeName} Crisis - Timothy Brits`}
  description={pageDescription}
  canonicalUrl={canonicalUrl}
>
  <div class='page-wrapper'>
    <main class='container' id='container'>
      <div class='country-page'>
        <CountryHeader
          countryName={countryData?.name ?? safeName}
          countrySlug={countrySlug as string}
        />

        <CrisisSection summary={countryData?.currentCrisisSummary ?? ''} />

        {
          countryData?.humanitarianImpact && (
            <HumanitarianImpact
              humanitarianImpact={countryData.humanitarianImpact}
            />
          )
        }

        {countryData?.timeline && <Timeline timeline={countryData.timeline} />}

        {
          countryData?.colonialRoot && (
            <ColonialSection colonialRoot={countryData.colonialRoot} />
          )
        }

        {
          countryData?.coreTerms && (
            <HistoricalContext
              coreTerms={countryData.coreTerms}
              countrySlug={countrySlug}
            />
          )
        }

        {
          countryData?.takeAction && (
            <TakeAction takeAction={countryData.takeAction} />
          )
        }

        <div class='country-bottom-back'>
          <BackButton />
        </div>
      </div>
    </main>
  </div>
</Layout>

<style>
  .country-page {
    max-width: 800px;
    margin: 0 auto;
    padding: 1rem;
  }

  .country-bottom-back {
    display: flex;
    justify-content: center;
    margin: 1.25rem 0 0.5rem 0;
  }

  .country-page p {
    line-height: 1.7;
    color: var(--text-secondary);
    margin-bottom: 1rem;
  }

  @media (min-width: 769px) {
    .country-page {
      padding: 1.5rem;
    }
    .country-title {
      font-size: 2rem;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 1rem;
    }
    .country-flag {
      font-size: 1.5rem;
    }
  }
</style>
