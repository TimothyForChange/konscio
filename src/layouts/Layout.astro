---
import '@fontsource-variable/geist';
import '../styles/reset.css';
import '../styles/global.css';
import Footer from '../components/layout/Footer.astro';

export let title = 'Timothy Brits';
export let description = undefined;
export let canonicalUrl = undefined;
export let countrySlug: string | undefined = undefined;

const ldObject = {
  '@context': 'https://schema.org',
  '@graph': [
    {
      '@type': 'Person',
      '@id': 'https://www.timothyforchange.co.za/#person',
      name: 'Timothy Brits',
      alternateName: 'Timothy',
      url: 'https://www.timothyforchange.co.za',
      image: 'https://www.timothyforchange.co.za/me.webp',
      jobTitle: 'Software Engineer',
      address: {
        '@type': 'PostalAddress',
        addressLocality: 'Pretoria',
        addressCountry: 'ZA',
      },
      knowsAbout: [
        'Software Development',
        '.NET',
        'Node.js',
        'Humanitarian Awareness',
        'Global Crises',
      ],
      sameAs: [
        'https://github.com/TimothyForChange',
        'https://www.instagram.com/timothyforchange/',
        'https://www.threads.com/@timothyforchange',
      ],
    },
    {
      '@type': 'WebSite',
      '@id': 'https://www.timothyforchange.co.za/#website',
      url: 'https://www.timothyforchange.co.za',
      name: 'Timothy Brits',
      description:
        'Timothy Brits - Software Engineer raising awareness about global humanitarian crises',
      publisher: {
        '@id': 'https://www.timothyforchange.co.za/#person',
      },
      potentialAction: {
        '@type': 'SearchAction',
        target: {
          '@type': 'EntryPoint',
          urlTemplate:
            'https://www.timothyforchange.co.za/?search={search_term_string}',
        },
        'query-input': 'required name=search_term_string',
      },
    },
  ],
};
const ldJson = JSON.stringify(ldObject, null, 2);
const countriesList = (await import('../data/countries.json')).default;
const countryNames = Array.isArray(countriesList)
  ? countriesList
      .map((c) => c.name)
      .filter(Boolean)
      .join(', ')
  : '';
const defaultDescription = `Timothy Brits - Software Engineer, raising awareness about global humanitarian crises. Learn about ongoing conflicts and humanitarian issues in ${countryNames}.`;
const baseKeywords = [
  'Timothy Brits',
  'developer',
  'software engineer',
  'advocacy',
  'humanitarian awareness',
  'global crises',
  'social justice',
  'humanitarian aid',
  'conflict awareness',
  'Pretoria',
];
const countryNamesArray = Array.isArray(countriesList)
  ? countriesList.map((c) => c.name).filter(Boolean)
  : [];
const keywordsList = [...baseKeywords, ...countryNamesArray].join(', ');
function trimDescription(desc: string, max = 160) {
  if (!desc) {
    return '';
  }
  const cleaned = desc.replace(/\s+/g, ' ').trim();
  return cleaned.length > max
    ? cleaned.slice(0, max - 1).trimEnd() + 'â€¦'
    : cleaned;
}

const rawDescription = description || defaultDescription;
const pageDescription = trimDescription(rawDescription, 160);
const pageCanonicalUrl = canonicalUrl || 'https://www.timothyforchange.co.za/';
const isCountryPage =
  typeof countrySlug === 'string' &&
  Array.isArray(countriesList) &&
  countriesList.some((c) => c.slug === countrySlug);
const defaultImage = '/me.webp';
const socialImage = isCountryPage ? undefined : defaultImage;
---

<!doctype html>
<html lang='en-GB'>
  <head>
    <meta charset='UTF-8' />
    <meta name='description' content={pageDescription} />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <meta name='author' content='Timothy Brits' />
    <meta name='keywords' content={keywordsList} />
    <meta name='robots' content='index, follow' />
    <meta property='og:type' content='website' />
    <meta property='og:url' content={pageCanonicalUrl} />
    <meta property='og:title' content={title} />
    <meta property='og:description' content={pageDescription} />
    <meta property='og:site_name' content='Timothy Brits' />
    {
      socialImage ? (
        <>
          <meta
            property='og:image'
            content={`https://www.timothyforchange.co.za${socialImage}`}
          />
          <meta name='twitter:card' content='summary_large_image' />
          <meta name='twitter:title' content={title} />
          <meta name='twitter:description' content={pageDescription} />
          <meta
            name='twitter:image'
            content={`https://www.timothyforchange.co.za${socialImage}`}
          />
        </>
      ) : (
        <meta name='twitter:card' content='summary' />
      )
    }
    <meta name='color-scheme' content='light dark' />
    <link rel='canonical' href={pageCanonicalUrl} />
    <link rel='apple-touch-icon' sizes='180x180' href='/apple-touch-icon.png' />
    <link rel='icon' type='image/png' sizes='32x32' href='/favicon-32x32.png' />
    <link rel='icon' type='image/png' sizes='16x16' href='/favicon-16x16.png' />
    <link rel='manifest' href='/site.webmanifest' />
    <title>{title}</title>
    <link rel='sitemap' href='/sitemap-index.xml' />
    <script type='application/ld+json' set:html={ldJson} />
  </head>
  <body>
    <a class='skip-link' href='#container'>Skip to main content</a>
    <slot />
    <Footer />
  </body>
</html>
